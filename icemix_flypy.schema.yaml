# Rime schema
# encoding: utf-8

# 混拼方案，基于 double_pinyin_flypy.schema.yaml 定制。
# 支持混合输入 小鹤双拼 + 雾凇拼音 + 简拼，参考 https://dvel.me/posts/rime-full-pinyin-double-pinyin-mixed-input/
# 支持带音调的拼音反查，使用 https://github.com/amzxyz/RIME-LMDG 字典
# 双拼键位映射复制自 https://github.com/rime/rime-double-pinyin
# 双拼之间主要就是 speller/algebra 和 translator/preedit_format 这里有区别
#
# 全拼的自定义文本和双拼有些冲突，改成了 custom_phrase_double ，需要创建 custom_phrase_double.txt 文件
#
# 目前配置中有个别功能仍然是全拼拼写，不能自动适配，所以需要手动修改一下：
# - 英文中部分符号的派生规则：在英文方案文件 melt_eng.schema.yaml > speller > algebra 修改为对应的双拼拼写运算
# - 部件拆字的拼写规则：在部件拆字方案 radical_pinyin.schema.yaml > speller > algebra 修改为对应的双拼拼写运算
# 打个补丁一劳永逸，补丁写法参考 [常见问题](https://github.com/iDvel/rime-ice/issues/133) 或 others/双拼补丁示例/ 文件夹

# 方案说明
schema:
  schema_id: icemix_flypy
  name: 凇鹤混拼
  version: '1'
  author:
    - jxai
    - Dvel
  description: |
    混拼方案，支持混合输入 小鹤双拼 + 雾凇拼音 + 简拼
    https://github.com/jxai/rime-icemix
  dependencies:
    __include: icemix_common:/schema/dependencies

switches:
  __include: icemix_common:/switches

engine:
  __include: icemix_common:/engine

date_translator:
  __include: icemix_common:/date_translator

lunar:
  __include: icemix_common:/lunar

uuid:
  __include: icemix_common:/uuid

reduce_english_filter:
  __include: icemix_common:/reduce_english_filter

pin_cand_filter:
  __include: icemix_common:/pin_cand_filter

long_word_filter:
  __include: icemix_common:/long_word_filter

# 主翻译器，拼音
translator:
  __include: icemix_common:/translator
  prism: icemix_flypy # 多方案共用一个词库时，为避免冲突，需要用 prism 指定一个名字。

melt_eng:
  __include: icemix_common:/melt_eng

# 中英混合词汇
cn_en:
  __include: icemix_common:/cn_en
  user_dict: en_dicts/cn_en_flypy

custom_phrase:
  __include: icemix_common:/custom_phrase

emoji:
  __include: icemix_common:/emoji

traditionalize:
  __include: icemix_common:/traditionalize

punctuator:
  __include: icemix_common:/punctuator

radical_lookup:
  __include: icemix_common:/radical_lookup

radical_reverse_lookup:
  __include: icemix_common:/radical_reverse_lookup

recognizer:
  __include: icemix_common:/recognizer

key_binder:
  __include: icemix_common:/key_binder

editor:
  __include: icemix_common:/editor

# 拼写设定
speller:
  # 如果不想让什么标点直接上屏，可以加在 alphabet，或者编辑标点符号为两个及以上的映射
  alphabet: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA`
  # initials 定义仅作为始码的按键，排除 ` 让单个的 ` 可以直接上屏
  initials: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA
  delimiter: " '" # 第一位<空格>是拼音之间的分隔符；第二位<'>表示可以手动输入单引号来分割拼音。
  algebra:
    # 超级简拼
    - abbrev/^([zcs]h).+$/$1/ # zh ch sh 视为整体（ch'sh → 城市），而非（c'h's'h → 吃好睡好）
    - abbrev/^([a-z]).+$/$1/
    - erase/^xx$/
    # 以下基于radical_pinyin.schema.yaml:algebra_flypy修改，和拆字反查共用一致的混拼方案
    - derive/^([jqxy])u(?=^|$|')/$1v/
    - derive/'([jqxy])u(?=^|$|')/'$1v/
    - derive/^([aoe])([ioun])(?=^|$|')/$1$1$2/
    - derive/'([aoe])([ioun])(?=^|$|')/'$1$1$2/
    - derive/^([aoe])(ng)?(?=^|$|')/$1$1$2/
    - derive/'([aoe])(ng)?(?=^|$|')/'$1$1$2/
    - derive/iu(?=^|$|')/<q>/
    - derive/(.)ei(?=^|$|')/$1<w>/
    - derive/uan(?=^|$|')/<r>/
    - derive/[uv]e(?=^|$|')/<t>/
    - derive/un(?=^|$|')/<y>/
    - derive/^sh/<u>/
    - derive/^ch/<i>/
    - derive/^zh/<v>/
    - derive/'sh/'<u>/
    - derive/'ch/'<i>/
    - derive/'zh/'<v>/
    - derive/uo(?=^|$|')/<o>/
    - derive/ie(?=^|$|')/<p>/
    - derive/([a-z>])i?ong(?=^|$|')/$1<s>/
    - derive/ing(?=^|$|')|uai(?=^|$|')/<k>/
    - derive/([a-z>])ai(?=^|$|')/$1<d>/
    - derive/([a-z>])en(?=^|$|')/$1<f>/
    - derive/([a-z>])eng(?=^|$|')/$1<g>/
    - derive/[iu]ang(?=^|$|')/<l>/
    - derive/([a-z>])ang(?=^|$|')/$1<h>/
    - derive/ian(?=^|$|')/<m>/
    - derive/([a-z>])an(?=^|$|')/$1<j>/
    - derive/([a-z>])ou(?=^|$|')/$1<z>/
    - derive/[iu]a(?=^|$|')/<x>/
    - derive/iao(?=^|$|')/<n>/
    - derive/([a-z>])ao(?=^|$|')/$1<c>/
    - derive/ui(?=^|$|')/<v>/
    - derive/in(?=^|$|')/<b>/
    - xform/'|<|>//
